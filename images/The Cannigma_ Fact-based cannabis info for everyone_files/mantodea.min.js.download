(()=>{function E(){for(var e=window.mantis_queue.splice(0,window.mantis_queue.length),t=0;t<e.length;t++)window.mantis.push.call(window.mantis,e[t])}function m(e,t){var n=document.createElement("img");n.src=e,n.alt="blank pixel",n.style.cssText="display:none !important;",(t||document.body).appendChild(n)}function x(e,t){window.mantis_queue=window.mantis_queue||(window.mantis&&Array.isArray(window.mantis)?window.mantis:[]),window.mantis_queued=window.mantis_queued||{},window.mantis_listen=window.mantis_listen||{},window.mantis={push:function(){var r=arguments[0],i=null,o=null;if(r&&r.length>=2&&(i=r[0],o=r[1]),window.mantis_queued[i]=!0,i&&o&&window.mantis_listen[i]){for(var a=[],l=2;l<r.length;++l)a[a.length]=r[l];var d=window.mantis_listen[i][o];d&&d.apply(window.mantis_listen[i],a);return}window.mantis_queue.push(r)}};var n=function(){window.mantis_listen[e]||(window.mantis_listen[e]=t),E()};if(document.readyState!=="loading")return n();var s=document.onreadystatechange;document.onreadystatechange=function(r){document.readyState!=="loading"&&n(),s&&s.call(document,r)}}function f(){try{return window.self!==window.top}catch{return!0}}function w(e){return typeof e.context=="object"&&(e.context.tagName=="AMP-AD"||e.context.tagName=="AMP-EMBED")}function v(){var e;if(!f())try{e=window.top.document.location.href}catch{}return w(window)&&(!e&&window.context.canonicalUrl&&(e=window.context.canonicalUrl),!e&&window.context.location&&(e=window.context.location.href)),e}var c="all:unset;display:revert",C=1e3;function h(e){let t=e.getBoundingClientRect().width;return t===0&&e.parentElement&&(t=e.parentElement.getBoundingClientRect().width),t}function _(e,t,n=.7){let s={threshold:n,root:null,rootMargin:"0px"},r=!1;new IntersectionObserver(function(i){i.some(function(a){return a.isIntersecting})&&setTimeout(function(){new IntersectionObserver(function(a){a.some(function(d){if(!d.isIntersecting)return!1;let u=d.boundingClientRect;return u&&u.width>30&&u.height>30})&&(r||(r=!0,t()))},s).observe(e)},C)},s).observe(e)}function g(e){if(w(window))return null;try{return window.localStorage.getItem("mantis:"+e)||null}catch{return null}}function b(e,t){if(!(!t||w(window)))try{window.localStorage.setItem("mantis:"+e,t)}catch{}}var y=class{constructor(t){this.config=t;this.zones={};this.loaded=[]}async load(t){let n=document.querySelectorAll("[data-mantis-zone]");for(let i of Array.from(n)){let o=i.getAttribute("data-mantis-zone");(!t||t.includes(o)||!this.zones[o])&&(this.zones[o]={el:i,width:h(i)})}let s=t||Object.keys(this.zones).filter(i=>!this.loaded.includes(i));if(s.length===0)return;this.loaded=[...this.loaded,...s];let r=await this.query(s);if(r.error){this.loaded=this.loaded.filter(i=>!s.includes(i));return}w(window)&&r.ads.length===0&&window.context.noContentAvailable();for(let i of r.ads){let{el:o}=this.zones[i.zone_id];if(o){if(!o.parentNode)if(o=document.querySelector(`[data-mantis-zone="${i.zone_id}"]`),o)this.zones[i.zone_id]={el:o,width:h(o)};else continue;this.render(o,i),w(window)&&window.context.reportRenderedEntityIdentifier("mantis-"+i.ad_id)}}for(let i of r.pixels)m(i)}async query(t){let n=t||Object.keys(this.zones),s={};for(let o of n)this.zones[o].width>=160&&(s[o]=this.zones[o].width);let r={url:v(),is_iframe:f(),demo:this.config.demo,last_viewed:JSON.parse(g("viewed")||"{}"),property_id:this.config.property||this.config.site,zones:n,widths:Object.keys(s).length>0?s:void 0,timezone:new Date().getTimezoneOffset()*-1};return await(await fetch((window.mantis_endpoint||"https://ssp.mantis.marketing")+"/display",{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"text/plain"}})).json()}render(t,n){t.innerHTML="";let s=`width:${n.creative_width}px;height:${n.creative_height}px;overflow:hidden`,r=document.createElement("div");r.style.cssText=`${c};${s};width:100%;max-width:${n.creative_width}px;height:${n.creative_height}px;position:relative;margin:0 auto`,t.appendChild(r);let i=document.createElement("iframe");i.style.cssText=`${c};${s};position:absolute;top:0;left:0`,r.appendChild(i);let o=i.contentWindow.document;if(o.open(),n.creative_url){let a=document.createElement("a");a.href=n.click_url,a.target="_blank",a.style.cssText=`cursor:pointer;position:relative;display:block;${s}`;let l=document.createElement("img");l.width=n.creative_width,l.height=n.creative_height,l.style.cssText=`${c};${s}`,a.appendChild(l);let d=document.createElement("a");d.target="_blank",d.href="https://www.mantisadnetwork.com/?utm_source=mantis&utm_medium=display&utm_campaign=adicon",d.style.cssText="position:absolute;cursor:pointer;top:1px;right:1px;width:18px;height:18px;overflow:hidden";let u=document.createElement("img");u.style.cssText=`${c};overflow:hidden`,d.appendChild(u),d.onmouseover=()=>{d.style.width="110px"},d.onmouseout=()=>{d.style.width="18px"},a.appendChild(d),o.write(`<!DOCTYPE html><html style="${c};${s}" lang="en"><body style="${c};${s}"></body></html>`),o.close(),o.body.appendChild(a),l.src=n.creative_url,u.src="https://static.mantis.marketing/adsbymantis.svg"}else n.creative_html&&(o.write(`<!DOCTYPE html><html style="${c};${s}" lang="en"><body style="${c};${s}">${n.creative_html}</body></html>`),o.close());_(i,function(){let a=JSON.parse(g("viewed")||"{}");a[n.campaign_id]=Date.now(),b("viewed",JSON.stringify(a));for(let l of n.viewed_pixels)m(l,t)});for(let a of n.served_pixels)m(a,t)}},p;x("display",{load(e){p||(p=new y(e)),p.load().catch(t=>{e.onError?e.onError(t):console.error(t)})},refresh:function(e){p&&p.load.apply(p,typeof e=="string"?[[e]]:[])}});window.MANTIS&&window.mantis.push(["display","load",window.MANTIS]);})();
